//#RequireContext CSmMode
#Include "ChaseAlliance/Libs/Common/Events.Script.txt" as Events
#Include "ChaseAlliance/Libs/ChaseAlliance/Consts/Colors.Script.txt" as Colors

#Include "TextLib" as TL

#Const C_Playing 0
#Const C_Waiting 1
#Const C_Pause 2

declare Integer G_GameState;

Void AllowGiveUp(){
	RespawnBehaviour = CSmMode::ERespawnBehaviour::GiveUpBeforeFirstCheckpoint;
	GiveUpBehaviour = CSmMode::EGiveUpBehaviour::GiveUp;
}

Void PreventGiveUp(){
	RespawnBehaviour = CSmMode::ERespawnBehaviour::AlwaysRespawn;
	GiveUpBehaviour = CSmMode::EGiveUpBehaviour::DoNothing;
}

Text GetStateText(){
	switch (G_GameState) {
		case 0: return "Playing";
		case 1: return "Waiting";
		case 2: return "Pause";
	}
	return "?";
}

Void ToNet(){
	declare netwrite Integer Net_GameState for Teams[0] = 1;
	Net_GameState = G_GameState;
}

Boolean IsPlaying(){
	return G_GameState == C_Playing;
}
Void SetPlaying(){
	G_GameState = C_Playing;
	PreventGiveUp();
	ToNet();
}

Boolean IsWaiting(){
	return G_GameState == C_Waiting;
}
Void SetWaiting(){
	G_GameState = C_Waiting;
	AllowGiveUp();
	ToNet();
}

Boolean IsPause(){
	return G_GameState == C_Pause;
}
Void SetPause(){
	G_GameState = C_Pause;
	AllowGiveUp();
	ToNet();
}

Boolean IsWaitingOrPause(){
	return G_GameState > 0;
}

Void PassLibEvent(Events::K_Event _Event){
	if(_Event.Name == "Pause"){
		if(IsPause()){
			SetWaiting();
		}else{
			SetPause();
		}
	}
}

declare Boolean G_Loaded;
Void Unload() {
	G_Loaded = False;
	SetWaiting();
}

Void Load() {
	if(G_Loaded)return;
	Unload();
	G_Loaded = True;
	Events::Load();
}