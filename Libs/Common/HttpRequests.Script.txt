//#RequireContext CSmMode

#Include "ChaseAlliance/Libs/Common/Log.Script.txt"
#Include "ChaseAlliance/Libs/ChaseAlliance/Players.Script.txt" as PlayersL

Void PostPlayerCount(Text _HttpApiURL, Integer _PlayerCount) {
    declare CHttpRequest Req = Http.CreatePost(_HttpApiURL^"/player_count/"^_PlayerCount, "");
    // wait(Req.IsCompleted);
    // Log(Req.Result);
    Http.Destroy(Req);
}

Void PassModeEvent(CSmModeEvent _Event, Text _HttpApiURL){
	if (_Event.Type == CSmModeEvent::EType::OnPlayerAdded || _Event.Type == CSmModeEvent::EType::OnPlayerRemoved){
		// log("ModeEvent : PlayerCount: "^PlayersL::GetCurrentPlayerCount());
		if (_HttpApiURL != ""){
			PostPlayerCount(_HttpApiURL, PlayersL::GetCurrentPlayerCount());
		}
	}
}

declare Boolean G_Loaded;
Void Unload() {
	G_Loaded = False;
}

Void Load() {
	if(G_Loaded)return;
	Unload();
	G_Loaded = True;
}





